{% extends "base.html" %}
{% macro authorlist(authors) %}
{% set_global _authors = [] %}
{% for author in authors | split(pat=" and ") %}
{% set name = author | split(pat=",") | reverse | join(sep=" ") | trim %}
{% if name == "Wil Thomason" or name == "Wil B. Thomason" %}
{% set name = "**" ~ name ~ "**" %}
{% endif %}
{% if loop.last %}
{% set name = "and " ~ name %}
{% endif %}
{% set_global _authors = _authors | concat(with=name) %}
{% endfor %}
{% if _authors | length == 2 %}
{% set authsep = " " %}
{% else %}
{% set authsep = ", " %}
{% endif %}
{{ _authors | join(sep=authsep) | markdown(inline=true) | safe }}.
{% endmacro authorlist %}
{% macro rawbibtex(paper) %}
@{{ paper.entry_type | safe }}{% raw %}{{% endraw %}{{ paper.citation_key | safe }},{% for tag, val in paper.tags %}{% if tag == "file" or tag == "extra" or tag == "abstract" %}{% continue %}{% endif %}
  {{ tag | safe }} = {% raw %}{{% endraw %}{{ val | safe }}{% raw %}}{% endraw %}{% if not loop.last %},{% endif %}{% endfor %}}
}{% endmacro %}
{% block content %}
<script src="js/collapsible_bibtex.js"></script>
{% set pubs = load_data(path="@/publications/publications.bib", format="bibtex") %}
{% set_global conference_articles = pubs.bibliographies | filter(attribute="entry_type", value="inproceedings") %}
{% set_global journal_articles = pubs.bibliographies | filter(attribute="entry_type", value="article") %}
{% for article in journal_articles %}
{% if article.tags.conference %}
{% set_global conference_articles = conference_articles | concat(with=article) %}
{% endif %}
{% endfor %}
<h1>Conference Publications</h1>
<div class="pubs">
{% set_global year = "0" %}
{% for paper in conference_articles | sort(attribute="tags.date") | reverse %}
{% set paper_year = paper.tags.date | split(pat="-") | nth(n=0) %}
{% if year != paper_year %}
{% set_global year = paper_year %}
<div class="pubyear">{{paper_year}}</div>
{% else %}
<div class="pubyear"></div>
{% endif %}
<dl class="pubdata">
  <div class="pubitem">
    <dt class="pubtitle">
      <b>“{{ paper.tags.title | replace(from="{{", to="") | replace(from="}}", to="") }}”</b>
    </dt>
    <dd>
      {{ self::authorlist(authors=paper.tags.author) }}
      {% if paper.tags.conference %}
      <span>Presented at {{ paper.tags.conference }}.</span>
      <span>Published in {{ paper.tags.journaltitle | replace(from="{{", to="") | replace(from="}}", to="") }}, {{ paper_year }}.</span>
      {% else %}
      <span>{{ paper.tags.booktitle | replace(from="{{", to="") | replace(from="}}", to="") }}, {{ paper_year }}.</span>
      {% endif %}
      {% if paper.tags.note %}
      {{ paper.tags.note }}
      {% endif %}
      <br />
      <a class="paperlink" href="{{ paper.tags.url }}">PDF</a>
      <span class="linksep">/</span>
      <span class="bibtexcollapsible">BibTeX</span>
      <div class="bibtexcontent">
        <pre>{{ self::rawbibtex(paper=paper)}}</pre>
      </div>
    </dd>
  </div>
</dl>
{% endfor %}
</div>

<h1>Journal Publications</h1>
<div class="pubs">
{% set_global year = "0" %}
{% for paper in journal_articles | sort(attribute="tags.date") | reverse %}
{% set paper_year = paper.tags.date | split(pat="-") | nth(n=0) %}
{% if year != paper_year %}
{% set_global year = paper_year %}
<div class="pubyear">{{paper_year}}</div>
{% else %}
<div class="pubyear"></div>
{% endif %}
<dl class="pubdata">
  <div class="pubitem">
    <dt class="pubtitle">
      <b>“{{ paper.tags.title | replace(from="{{", to="") | replace(from="}}", to="") }}”</b>
    </dt>
    <dd>
      {{ self::authorlist(authors=paper.tags.author) }}
      <span>{{ paper.tags.journaltitle | replace(from="{{", to="") | replace(from="}}", to="") }}, {{ paper_year }}.</span>
      {% if paper.tags.note %}
      {{ paper.tags.note }}
      {% endif %}
      <br />
      <a class="paperlink" href="{{ paper.tags.url }}">PDF</a>
      <span class="linksep">/</span>
      <span class="bibtexcollapsible">BibTeX</span>
      <div class="bibtexcontent">
        <pre>{{ self::rawbibtex(paper=paper)}}</pre>
      </div>
    </dd>
  </div>
</dl>
{% endfor %}
</div>
{% endblock content %}
